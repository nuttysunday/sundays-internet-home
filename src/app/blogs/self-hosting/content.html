<!DOCTYPE html><html><head>
      <title>content</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="self-hosting">Self-Hosting </h1>
<p>I am a <em>Full Stack Developer</em>, but still learning stuff and I consider myself very naive, so please take this with a grain of salt.</p>
<p>Developing a web app is fun, writing UI, endpoints, designing database schemas is very interesting and can be very enjoyable and a great learning experience. But after you are done developing it locally how would you showcase this to the internet or  put it into an actual production environment. I am obviously talking about very small systems here &lt;1k requests a day, where scalability is often not an issue.</p>
<hr>
<ol>
<li>Virtual Private Server.<br>
<em>Examples: DigitalOcean Droplet, AWS EC2, Google Cloud Compute Engine</em></li>
<li>Self hosting your old computer.<br>
<em>Examples: raspberry pi</em></li>
<li>Using out of the box services.<br>
<em>Examples: Vercel, Supabase</em></li>
</ol>
<hr>
<h2 id="common-steps-for-method-1-and-2"><strong>Common Steps for Method 1 and 2</strong> </h2>
<h3 id="1-cloudflare-tunnel"><strong>1. Cloudflare Tunnel</strong> </h3>
<p>Instead of directly exposing the IP address of your wifi or of your VPS, I recommend to use a cloudflare tunnel, as it hides your IP address, and protects for Ddos and dos attack out of the box, also gives features like Geo fencing if necessary. And it is a free service, not necessary to purchase domain names from them.</p>
<h4 id="example-configuration"><strong>Example Configuration:</strong> </h4>
<ul>
<li><strong>credentials.json</strong>:</li>
</ul>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"AccountTag"</span><span class="token operator">:</span> <span class="token string">"abc"</span><span class="token punctuation">,</span>
  <span class="token property">"TunnelSecret"</span><span class="token operator">:</span> <span class="token string">"bigpass"</span><span class="token punctuation">,</span>
  <span class="token property">"TunnelID"</span><span class="token operator">:</span> <span class="token string">"xyz"</span>
<span class="token punctuation">}</span>
</code></pre><ul>
<li><strong>config.yml</strong>:</li>
</ul>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">tunnel</span><span class="token punctuation">:</span> xyz
<span class="token key atrule">credentials-file</span><span class="token punctuation">:</span> /etc/cloudflared/credentials.json
<span class="token key atrule">ingress</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">hostname</span><span class="token punctuation">:</span> shivam.foo
    <span class="token key atrule">service</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//portfolio<span class="token punctuation">:</span><span class="token number">8000</span>   
  <span class="token punctuation">-</span> <span class="token key atrule">hostname</span><span class="token punctuation">:</span> books.shivam.foo
    <span class="token key atrule">service</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//books<span class="token punctuation">:</span><span class="token number">8001</span>
  <span class="token punctuation">-</span> <span class="token key atrule">service</span><span class="token punctuation">:</span> http_status<span class="token punctuation">:</span><span class="token number">404</span>
</code></pre><blockquote>
<p><strong>Note</strong>: Make sure to have domain names listed in the DNS records on Cloudflare.</p>
</blockquote>
<h3 id="2-docker"><strong>2. Docker</strong> </h3>
<p>In methods 1 and 2, you need to dockerize your stuff which is easy for management, and push your code. Because, there could be a simple dependency issue, for eg, you are using the mysql-connector library for your endpoints to interact with your database. But let’s say this library is not supported for a particular Linux Distro, this could result in changing the code and could be very annoying.</p>
<p>Or let’s say you need to use mysql server, if you don’t use docker you will need to download it, install it, configure it etc, but with docker just pull mysql image, spin up the container and you have it ready.</p>
<p>So using docker, is like having a “small exact copy of a virtual machine” everywhere, and having that docker container (“Virtual machine”) run everywhere.</p>
<p>Another benefit is support of docker-compose, which can easily help you manage multiple docker containers, and how they would interact with each in its docker network.</p>
<p>Make sure when you build the docker images, build and run them as the least privileged user, so the intruder cannot exit your docker container, or execute shell scripts inside the docker container terminal.</p>
<p>Instead of doing this on host machine:-<br>
<a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/">https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/</a></p>
<p>I also prefer to run cloudflare inside the docker container, for easier management and no need to do any external setup on the host machine.</p>
<h3 id="4-docker-watchtower"><strong>4. Docker Watchtower</strong> </h3>
<p>Once you build and push the images to docker hub, they need to be updated right on the server? So docker watchtower comes into play here. Docker watchtower automatically pulls the images from dockerhub, and rebuilds them automatically.</p>
<p>And as we are using docker-compose, we can also smoothly integrate docker watchtower in our containers. Make sure your repository on docker hub is public so watchtower can pull the images.</p>
<p>Getting up your app:-</p>
<p>Have your pi up and running with:</p>
<ol>
<li>Raspberry Pi os installed</li>
<li>Docker and docker compose installed</li>
<li>Remote Desktop enabled.</li>
</ol>
<blockquote>
<p><strong>Note</strong>: Ensure your Docker Hub repository is public so that Watchtower can pull the images.</p>
</blockquote>
<hr>
<h3 id="5-deploying-the-application"><strong>5. Deploying the Application</strong> </h3>
<p>To transfer the files from host to server you can use scp command:-</p>
<p>scp -r /local/directory username@remote_host:/path/to/remote/destination/</p>
<p>After having files on the server:-</p>
<p>ssh into the remote desktop:- (Pi)</p>
<p>ssh into google compute engine:-</p>
<p>Simply doing:- docker-compose up –build -d</p>
<p>This will build the service and could be accessed anywhere on the internet.</p>
<hr>
<h2 id="special-considerations-for-method-2-self-hosting-on-raspberry-pi"><strong>Special Considerations for Method 2 (Self-hosting on Raspberry Pi)</strong> </h2>
<h3 id="1-openvpn"><strong>1. OpenVPN</strong> </h3>
<p>Using openvpn protocol and service of your choice (mine is Surfshark), connect to the nearest remote server, so we have added protection layer for the request to bypass.</p>
<h3 id="2-firewall-configuration-ufw-rules"><strong>2. Firewall Configuration (UFW Rules)</strong> </h3>
<p>Set strict firewall rules to secure your Raspberry Pi:</p>
<ul>
<li>Allow incoming traffic only on necessary ports (SSH, HTTP/HTTPS).</li>
<li>Allow outgoing traffic only for VPN, internet access, and local router communication.</li>
</ul>
<p>You can verify up, you should be able to ping pi from any other machine on the network, but vice-versa not possible.</p>
<h3 id="3-isolating-the-pi-on-a-separate-subnet"><strong>3. Isolating the Pi on a Separate Subnet</strong> </h3>
<p>If possible, set up a separate guest network for the Pi to prevent it from interacting with other devices on your main network.</p>
<hr>
<h2 id="optimizing-nextjs-builds-with-git-pre-commit-hooks"><strong>Optimizing Next.js Builds with Git Pre-Commit Hooks</strong> </h2>
<p>When you build your next js app using github actions it takes up a lot of time,</p>
<p>This action, built the Next js app, created its image and pushed to dockerhub.</p>
<p>So i decide to use git pre-commit hooks, what this does it, builds the Next js locally, creates docker image, spins up the container, and if you like it and everything looks fine, you enter “Y”, then it cleans up the container, and add the build files and pushed it github, and the github actions builds the container, and pushes to docker hub without building next js app.</p>
<p>Reducing the build time to &lt;1min.</p>
<p>Here is the .git hooks precommit file:-</p>
<p>(Runs after you enter commit)</p>
<p><a href="https://docs.google.com/document/d/17RpP_tp1d5I681uoPfTGfXTvQf9wmJ3BZWdLqE_22k4/edit?tab=t.0">https://docs.google.com/document/d/17RpP_tp1d5I681uoPfTGfXTvQf9wmJ3BZWdLqE_22k4/edit?tab=t.0</a></p>
<hr>
<h2 id="method-3-using-out-of-the-box-services-vercel-and-supabase"><strong>Method 3: Using Out-of-the-Box Services (Vercel and Supabase)</strong> </h2>
<ol>
<li>
<p>No need to dockerize, no need to download mysql server or anything, directly use vercel, which simply lets you deploy your NextJS app on it, as it handles all the configuration underhood and you need not worry about anything. Using vercel saves you a lot of time, and you need not need to even create an account on Amazon and get your EC2 instance, or dockerize any shit in the first place.</p>
</li>
<li>
<p>Using supabase for databases, this is like already having a mysql server setup in the cloud for you, without you needing to do anything.</p>
</li>
</ol>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>