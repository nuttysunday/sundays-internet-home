<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/images/self-hosting/pi.jpg"/><link rel="preload" as="image" href="/images/self-hosting/ssh_pi.jpg"/><link rel="preload" as="image" href="/images/self-hosting/ssh_gc.png"/><link rel="preload" as="image" href="/images/self-hosting/firewall_config.jpg"/><link rel="preload" as="image" href="/images/self-hosting/ci_cd_15.png"/><link rel="preload" as="image" href="/images/self-hosting/ci_cd_1.png"/><link rel="stylesheet" href="/_next/static/css/e588391ba1a1e79e.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/68cef8b171ba9fef.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-2b9fb6867f1b33aa.js"/><script src="/_next/static/chunks/fd9d1056-858637d525bb3ac1.js" async=""></script><script src="/_next/static/chunks/23-f5f819f656054356.js" async=""></script><script src="/_next/static/chunks/main-app-6af752caf62e832e.js" async=""></script><script src="/_next/static/chunks/467-0209e4efb2d5d7a5.js" async=""></script><script src="/_next/static/chunks/231-8b6b665dad519162.js" async=""></script><script src="/_next/static/chunks/10-40d6703f678e539e.js" async=""></script><script src="/_next/static/chunks/app/blogs/self-hosting/page-6ddfbf9f41080f05.js" async=""></script><script src="/_next/static/chunks/174-3e6a25153a9a191d.js" async=""></script><script src="/_next/static/chunks/app/layout-b6b862cb0fe97ac5.js" async=""></script><script src="/_next/static/chunks/app/not-found-5210fdf515d5cae2.js" async=""></script><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><style data-emotion="css lcc8hc">.css-lcc8hc{max-width:1200px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:relative;}@media (min-width:0px){.css-lcc8hc{width:100%;}}@media (min-width:1200px){.css-lcc8hc{width:70%;}}</style><div class="font-mono text-indigo-300 MuiBox-root css-lcc8hc"><style data-emotion="css nzgnv7">.css-nzgnv7{position:-webkit-sticky;position:sticky;top:0;z-index:1000;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;background:linear-gradient(to top, rgba(24, 24, 27, 0.9), rgba(24, 24, 27, 1));border-radius:8px;}@media (min-width:0px){.css-nzgnv7{margin-top:1rem;margin-bottom:1rem;padding:1rem;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:1rem;box-shadow:none;}}@media (min-width:600px){.css-nzgnv7{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}@media (min-width:900px){.css-nzgnv7{margin-top:2.5rem;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}@media (min-width:1200px){.css-nzgnv7{box-shadow:none;}}</style><div class="MuiBox-root css-nzgnv7"><style data-emotion="css a47ou8">.css-a47ou8{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}@media (min-width:0px){.css-a47ou8{gap:1rem;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;}}@media (min-width:600px){.css-a47ou8{gap:1rem;}}@media (min-width:900px){.css-a47ou8{gap:3rem;}}</style><div class="MuiBox-root css-a47ou8"><a href="/"><style data-emotion="css 29w8sm">.css-29w8sm{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;font-style:italic;padding:0.5rem 0;}@media (min-width:0px){.css-29w8sm{font-size:0.8rem;}}@media (min-width:600px){.css-29w8sm{font-size:1rem;}}.css-29w8sm:hover{color:gray;}</style><p class="MuiTypography-root MuiTypography-body1 css-29w8sm">ABOUT</p></a><a href="/work"><p class="MuiTypography-root MuiTypography-body1 css-29w8sm">WORK</p></a><a href="/skills"><p class="MuiTypography-root MuiTypography-body1 css-29w8sm">SKILLS</p></a><a href="/projects"><p class="MuiTypography-root MuiTypography-body1 css-29w8sm">PROJECTS</p></a><a href="/blogs"><style data-emotion="css 16f8bid">.css-16f8bid{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;color:white;font-style:normal;padding:0.5rem 0;}@media (min-width:0px){.css-16f8bid{font-size:0.8rem;}}@media (min-width:600px){.css-16f8bid{font-size:1rem;}}.css-16f8bid:hover{color:gray;}</style><p class="MuiTypography-root MuiTypography-body1 css-16f8bid">BLOGS</p></a></div><style data-emotion="css 1kak77o">.css-1kak77o{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:16px;}@media (min-width:0px){.css-1kak77o{-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;}}</style><div class="MuiBox-root css-1kak77o"><style data-emotion="css mehom5">.css-mehom5{-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:var(--Link-underlineColor);--Link-underlineColor:rgba(25, 118, 210, 0.4);}.css-mehom5:hover{text-decoration-color:inherit;}</style><style data-emotion="css 1okaolj">.css-1okaolj{margin:0;font:inherit;line-height:inherit;letter-spacing:inherit;color:#1976d2;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:var(--Link-underlineColor);--Link-underlineColor:rgba(25, 118, 210, 0.4);}.css-1okaolj:hover{text-decoration-color:inherit;}</style><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1okaolj" href="https://github.com/nuttysunday" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><style data-emotion="css 1uphsbo">.css-1uphsbo{padding:8px;padding-right:8px;border-radius:50%;-webkit-transition:-webkit-transform 0.3s ease;transition:transform 0.3s ease;}@media (min-width:0px){.css-1uphsbo{padding-left:0px;}}.css-1uphsbo:hover{-webkit-transform:scale(1.5);-moz-transform:scale(1.5);-ms-transform:scale(1.5);transform:scale(1.5);}</style><div class="MuiBox-root css-1uphsbo"><style data-emotion="css 8t147v">.css-8t147v{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;fill:currentColor;font-size:1.5rem;color:white;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-8t147v" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="GitHubIcon"><path d="M12 1.27a11 11 0 00-3.48 21.46c.55.09.73-.28.73-.55v-1.84c-3.03.64-3.67-1.46-3.67-1.46-.55-1.29-1.28-1.65-1.28-1.65-.92-.65.1-.65.1-.65 1.1 0 1.73 1.1 1.73 1.1.92 1.65 2.57 1.2 3.21.92a2 2 0 01.64-1.47c-2.47-.27-5.04-1.19-5.04-5.5 0-1.1.46-2.1 1.2-2.84a3.76 3.76 0 010-2.93s.91-.28 3.11 1.1c1.8-.49 3.7-.49 5.5 0 2.1-1.38 3.02-1.1 3.02-1.1a3.76 3.76 0 010 2.93c.83.74 1.2 1.74 1.2 2.94 0 4.21-2.57 5.13-5.04 5.4.45.37.82.92.82 2.02v3.03c0 .27.1.64.73.55A11 11 0 0012 1.27"></path></svg></div></a><style data-emotion="css 1pbqw4f">.css-1pbqw4f{z-index:1500;pointer-events:none;pointer-events:auto;pointer-events:none;}.css-1pbqw4f[data-popper-placement*="bottom"] .MuiTooltip-arrow{top:0;margin-top:-0.71em;}.css-1pbqw4f[data-popper-placement*="bottom"] .MuiTooltip-arrow::before{transform-origin:0 100%;}.css-1pbqw4f[data-popper-placement*="top"] .MuiTooltip-arrow{bottom:0;margin-bottom:-0.71em;}.css-1pbqw4f[data-popper-placement*="top"] .MuiTooltip-arrow::before{transform-origin:100% 0;}.css-1pbqw4f[data-popper-placement*="right"] .MuiTooltip-arrow{height:1em;width:0.71em;}.css-1pbqw4f[data-popper-placement*="right"] .MuiTooltip-arrow::before{transform-origin:100% 100%;}.css-1pbqw4f[data-popper-placement*="left"] .MuiTooltip-arrow{height:1em;width:0.71em;}.css-1pbqw4f[data-popper-placement*="left"] .MuiTooltip-arrow::before{transform-origin:0 0;}.css-1pbqw4f[data-popper-placement*="right"] .MuiTooltip-arrow{left:0;margin-left:-0.71em;}.css-1pbqw4f[data-popper-placement*="left"] .MuiTooltip-arrow{right:0;margin-right:-0.71em;}</style><style data-emotion="css rh2ver">.css-rh2ver{z-index:1500;pointer-events:none;pointer-events:auto;pointer-events:none;}.css-rh2ver[data-popper-placement*="bottom"] .MuiTooltip-arrow{top:0;margin-top:-0.71em;}.css-rh2ver[data-popper-placement*="bottom"] .MuiTooltip-arrow::before{transform-origin:0 100%;}.css-rh2ver[data-popper-placement*="top"] .MuiTooltip-arrow{bottom:0;margin-bottom:-0.71em;}.css-rh2ver[data-popper-placement*="top"] .MuiTooltip-arrow::before{transform-origin:100% 0;}.css-rh2ver[data-popper-placement*="right"] .MuiTooltip-arrow{height:1em;width:0.71em;}.css-rh2ver[data-popper-placement*="right"] .MuiTooltip-arrow::before{transform-origin:100% 100%;}.css-rh2ver[data-popper-placement*="left"] .MuiTooltip-arrow{height:1em;width:0.71em;}.css-rh2ver[data-popper-placement*="left"] .MuiTooltip-arrow::before{transform-origin:0 0;}.css-rh2ver[data-popper-placement*="right"] .MuiTooltip-arrow{left:0;margin-left:-0.71em;}.css-rh2ver[data-popper-placement*="left"] .MuiTooltip-arrow{right:0;margin-right:-0.71em;}</style><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1okaolj" href="https://www.linkedin.com/in/shivam-ghodke/" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn"><style data-emotion="css emi2x7">.css-emi2x7{padding:8px;padding-right:8px;border-radius:50%;-webkit-transition:-webkit-transform 0.3s ease;transition:transform 0.3s ease;}@media (min-width:0px){.css-emi2x7{padding-left:8px;}}.css-emi2x7:hover{-webkit-transform:scale(1.5);-moz-transform:scale(1.5);-ms-transform:scale(1.5);transform:scale(1.5);}</style><div class="MuiBox-root css-emi2x7"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-8t147v" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkedInIcon"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"></path></svg></div></a><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1okaolj" href="mailto:mail@shivam.foo" target="_blank" rel="noopener noreferrer" aria-label="Email"><div class="MuiBox-root css-emi2x7"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-8t147v" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="EmailIcon"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"></path></svg></div></a><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1okaolj" href="https://drive.google.com/file/d/1oiRDiDfy_RhmdgZE0C0CVOubbTuOliY5/view?usp=share_link" target="_blank" rel="noopener noreferrer" aria-label="Resume"><style data-emotion="css 18z8f6w">.css-18z8f6w{padding:8px;padding-right:0px;border-radius:50%;-webkit-transition:-webkit-transform 0.3s ease;transition:transform 0.3s ease;}@media (min-width:0px){.css-18z8f6w{padding-left:8px;}}.css-18z8f6w:hover{-webkit-transform:scale(1.5);-moz-transform:scale(1.5);-ms-transform:scale(1.5);transform:scale(1.5);}</style><div class="MuiBox-root css-18z8f6w"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-8t147v" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="FeedIcon"><path d="M16 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8zM7 7h5v2H7zm10 10H7v-2h10zm0-4H7v-2h10zm-2-4V5l4 4z"></path></svg></div></a><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1okaolj" href="https://x.com/sundaycide" target="_blank" rel="noopener noreferrer" aria-label="Twitter"><div class="MuiBox-root css-emi2x7"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-8t147v" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="XIcon"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg></div></a></div></div><style data-emotion="css unnlsk">.css-unnlsk{position:relative;z-index:1;margin-bottom:4rem;}@media (min-width:0px){.css-unnlsk{padding:1.2rem 1.2rem 0rem;text-align:left;}}@media (min-width:900px){.css-unnlsk{padding:0rem 2rem 0rem;text-align:justify;}}</style><div class="MuiBox-root css-unnlsk"><style data-emotion="css o95glz">.css-o95glz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:2rem;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;overflow-x:hidden;}</style><div class="MuiBox-root css-o95glz"><div class="MuiBox-root css-0"><a href="/blogs"><style data-emotion="css 1u9ws2n">.css-1u9ws2n{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;fill:currentColor;font-size:1.5rem;color:white;cursor:pointer;position:absolute;left:0rem;margin-top:1rem;}@media (min-width:0px){.css-1u9ws2n{display:none;}}@media (min-width:600px){.css-1u9ws2n{display:block;}}.css-1u9ws2n:hover{color:#fae263;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-1u9ws2n" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ArrowBackIcon"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"></path></svg></a><div><p class="text-pink-400 text-left md:text-justify text-2xl font-bold underline decoration-4">Self-hosting</p><p class="text-pink-400 text-left md:text-justify italic opacity-90 text-sm">18th Oct 2024, 6 min read</p></div></div><p class="text-pink-400 text-left md:text-justify">I am a <em>Full Stack Developer</em>, but still learning stuff and I consider myself naive, so please take this with a grain of salt.</p><p class="text-pink-400 text-left md:text-justify">Developing a web app is fun, writing UI components, defining API endpoints, and designing database schemas is very interesting and can be very enjoyable and a great learning experience. But after you are done developing it locally how would you showcase this to the internet or put it into an actual production environment. I am obviously talking about very small systems here &lt;1k requests a day, where scalability is often not an issue.</p><hr style="height:3px;background-color:white;border:none;filter:blur(2px)"/><ol><li class="text-pink-400 text-left md:text-justify mb-2">1. Virtual Private Server (VPS)<br/><em style="margin-left:2rem">DigitalOcean Droplet, AWS EC2, Google Cloud Compute Engine</em></li><li class="text-pink-400 text-left md:text-justify mb-2">2. Self-hosting on your old computer<br/><em style="margin-left:2rem">Raspberry Pi</em></li><li class="text-pink-400 text-left md:text-justify mb-2">3. Using out-of-the-box services<br/><em style="margin-left:2rem">Vercel, Supabase</em></li></ol><hr style="height:3px;background-color:white;border:none;filter:blur(2px)"/><style data-emotion="css 1oz971c">.css-1oz971c{border-radius:12px;overflow:hidden;margin:0 auto;min-height:215px;}@media (min-width:0px){.css-1oz971c{max-width:90%;}}@media (min-width:900px){.css-1oz971c{max-width:600px;}}</style><div class="MuiBox-root css-1oz971c"><iframe src="https://www.youtube.com/embed/_IoQ6Dux8g8?si=uCX2zliGSLllFJTB" allow="accelerometer; clipboard-write; encrypted-media" title="YouTube video player" style="width:100%;height:215px;border:none"></iframe></div><div class="flex flex-col items-center"><p class="text-pink-400 text-left md:text-justify text-white">Youtube video showing live demo, of integrating hosting with CI/CD.</p></div><div class="flex flex-col items-center"><picture><source media="(max-width: 600px)" srcSet="/images/self-hosting/production.png"/><img src="/images/self-hosting/production.svg" alt="Description of image" class="rounded-sm w-full"/></picture><p class="text-pink-400 text-left md:text-justify mt-2 text-white">Understanding the pipeline</p><a href="https://viewer.diagrams.net/?tags=%7B%7D&amp;lightbox=1&amp;highlight=0000ff&amp;edit=_blank&amp;layers=1&amp;nav=1&amp;title=CI%2FCD%20pipeline%20for%20portfolio%20website#Uhttps%3A%2F%2Fdrive.google.com%2Fuc%3Fid%3D1xACutzDGnT_Wto5TjsegS1OjLt--fbDw%26export%3Ddownload" target="_blank" rel="noopener noreferrer" class="text-blue-400 underline">View the HD image @draw.io</a></div><p class="text-pink-400 text-left md:text-justify text-2xl font-bold">Common steps for method 1 and 2:-</p><p class="text-pink-400 text-left md:text-justify text-xl font-bold">1. Cloudflare Tunnel</p><p class="text-pink-400 text-left md:text-justify">Instead of directly exposing the IP address of your wifi or of your VPS, I recommend using a Cloudflare tunnel, as it hides your IP address, protects for DDOS and DOS attack out of the box, also gives features like Geo fencing if necessary. It is a free service, not necessary to purchase domain names from them.</p><p class="text-pink-400 text-left md:text-justify text-xl font-bold">2. Docker</p><p class="text-pink-400 text-left md:text-justify">In methods 1 and 2, you need to dockerize your stuff which is easy for management, and push your code. Because, there could be a simple dependency issue, for eg, you are using the MySQL-connector library for your endpoints to interact with your database. But let’s say this library is not supported for a particular Linux Distro, this could result in changing the code and could be very annoying.</p><p class="text-pink-400 text-left md:text-justify">Or let’s say you need to use a mysql server, if you don’t use docker you will need to download it, install it, configure it etc, but with docker just pull the mysql image, spin up the container and then you have it ready.</p><p class="text-pink-400 text-left md:text-justify">So using docker, is like having a “small exact copy of a virtual machine” everywhere, and having that docker container (“Virtual machine”) run everywhere.</p><p class="text-pink-400 text-left md:text-justify">Another benefit is the support of docker-compose, which can easily help you manage multiple docker containers, and how they would interact with each in its docker network.</p><p class="text-pink-400 text-left md:text-justify">Make sure when you build the docker images, build and run them as the least privileged user, so the intruder cannot exit your docker container, or execute shell scripts inside the docker container terminal.</p><p class="text-pink-400 text-left md:text-justify text-xl font-bold">3. Docker watchtower</p><p class="text-pink-400 text-left md:text-justify">Once you build and push the images to the docker hub, they need to be updated on the server right? So Docker Watchtower comes into play here. Docker Watchtower automatically pulls the images from the docker hub and rebuilds them automatically.</p><p class="text-pink-400 text-left md:text-justify">And as we are using docker-compose, we can also smoothly integrate docker watchtower in our containers. Make sure your repository on the docker hub is public so Watchtower can pull the images.</p><p class="text-pink-400 text-left md:text-justify text-xl font-bold">4. Connecting Docker watchtower and Cloudflare with your Docker app in docker-compose file</p><p class="text-pink-400 text-left md:text-justify">Directory Strucuture:-</p><pre class="bg-blue-950/90 p-4 rounded-3xl shadow-lg"><code class="text-pink-400 text-left md:text-justify ">/
├── cloudflared/
│   ├── config.yml
│   ├── credentials.json
├── docker-compose.yml
</code></pre><p class="text-pink-400 text-left md:text-justify">credentials.json:-</p><pre class="bg-blue-950/90 p-4 rounded-3xl shadow-lg overflow-x-auto"><code class="text-pink-400 text-left md:text-justify whitespace-pre-wrap">{
 tunnel: xyz
 credentials-file: /etc/cloudflared/credentials.json
 ingress:
   - hostname: commonTextStyle.foo  // domain name 
  // service name and the port of the container which is being exposed
     service:  http://portfolio:8000   
  - hostname: books.commonTextStyle.foo  // domain name 
     service:  http://books:8001
  - service: http_status:404
 
}</code></pre><p class="text-pink-400 text-left md:text-justify">config.yml:-</p><pre class="bg-blue-950/90 p-4 rounded-3xl shadow-lg overflow-x-auto"><code class="text-pink-400 text-left md:text-justify whitespace-pre-wrap">{
  &quot;AccountTag&quot;: &quot;abc&quot;,
  &quot;TunnelSecret&quot;: &quot;bigpass&quot;,
  &quot;TunnelID&quot;: &quot;xyz&quot;
}</code></pre><div class="bg-white/80 p-2 rounded-lg shadow-md border-l-4 border-blue-500"><h1 class="text-xl font-semibold text-blue-500">Important:</h1><p class="text-base text-gray-800">- You need to have the domain names in the DNS record on cloudflare to connect it with your tunnel.</p><p class="text-base text-gray-800">- Don’t share these credentials with anyone or anyone could spoof your tunnel.</p></div><a href=" https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/" target="_blank" rel="noopener noreferrer" class="text-blue-400 underline">Traditional way of setting up cloudflare</a><p class="text-pink-400 text-left md:text-justify">I prefer to run cloudflare inside the docker container, for easier management and no need to do any external setup on the host machine.</p><p class="text-pink-400 text-left md:text-justify">Docker-compose file part of Cloudflare and Watchtower:-</p><a href="https://github.com/nuttysunday/sundays-internet-home/blob/main/self-hosting-blogs-file/docker-compose.yml" target="_blank" rel="noopener noreferrer" class="text-blue-400 underline">Docker-compose file</a><pre class="bg-blue-950/90 p-4 rounded-3xl shadow-lg overflow-x-auto"><code class="text-pink-400 text-left md:text-justify whitespace-pre-wrap">
cloudflared:
  image: cloudflare/cloudflared:latest
  container_name: cloudflared
  volumes:
    - ./cloudflared/credentials.json:/etc/cloudflared/credentials.json:ro
    - ./cloudflared/config.yml:/etc/cloudflared/config.yml:ro
  command: tunnel --config /etc/cloudflared/config.yml run
  restart: always
  deploy:
    resources:
      limits:
        cpus: &#x27;0.3&#x27;
        memory: 256M
  cap_drop:
    - ALL
  read_only: true
  depends_on:
    - portfolio
  labels:
    com.centurylinklabs.watchtower.enable: &quot;true&quot;
  networks:
    - isolated_network

watchtower:
  image: containrrr/watchtower:latest
  container_name: watchtower
  volumes:
    - /var/run/docker.sock:/var/run/docker.sock
  restart: always
  deploy:
    resources:
      limits:
        cpus: &#x27;0.3&#x27;
        memory: 256M
  environment:
    - WATCHTOWER_LABEL_ENABLE=true
    - WATCHTOWER_POLL_INTERVAL=60
  command: --cleanup portfolio cloudflared
  networks:
    - isolated_network
</code></pre><p class="text-pink-400 text-left md:text-justify text-xl font-bold">5. Spinning up the containers.</p><p class="text-pink-400 text-left md:text-justify">Step1:- Get inside the remote server</p><p class="text-pink-400 text-left md:text-justify">To transfer the files from host to server you can use scp command:-</p><pre class="bg-blue-950/90 p-4 rounded-3xl shadow-lg overflow-x-auto"><code class="text-pink-400 text-left md:text-justify whitespace-pre-wrap"> scp -r /local/directory username@remote_host:/path/to/remote/destination/</code></pre><p class="text-pink-400 text-left md:text-justify text-xl font-bold">Have your pi up and running with:-</p><ol class="text-pink-400 text-left md:text-justify list-decimal list-inside"><li>Raspberry Pi OS installed</li><li>Docker and Docker Compose installed</li><li>Remote Desktop enabled</li></ol><div class="flex flex-col items-center mb-8 lg:mb-0"><img src="/images/self-hosting/pi.jpg" alt="Description of image" class="rounded-lg w-full max-w-[400px]"/><p class="text-pink-400 text-left md:text-justify mt-4 text-white">PI in Action</p></div><p class="text-pink-400 text-left md:text-justify">After having files on the server:-</p><div class="flex flex-col lg:flex-row lg:justify-center lg:space-x-8 items-center"><div class="flex flex-col items-center mb-8 lg:mb-0"><img src="/images/self-hosting/ssh_pi.jpg" alt="Description of image" class="rounded-lg w-full max-w-[400px]"/><p class="text-pink-400 text-left md:text-justify mt-4 text-white">SSH Into PI</p></div><div class="flex flex-col items-center"><img src="/images/self-hosting/ssh_gc.png" alt="Description of image" class="rounded-lg max-w-[400px]"/><p class="text-pink-400 text-left md:text-justify mt-4 text-white">SSH Into Google Cloud</p></div></div><p class="text-pink-400 text-left md:text-justify">Spinning up the containers:-</p><p class="text-pink-400 text-left md:text-justify"> <!-- -->This will build the service and could be accessed anywhere on the internet.</p><pre class="bg-blue-950/90 p-4 rounded-2xl shadow-lg"><code class="text-pink-400 text-left md:text-justify ">docker-compose up –build -d</code></pre><p class="text-pink-400 text-left md:text-justify text-2xl font-bold">Extra security steps for pi (method 2):-</p><p class="text-pink-400 text-left md:text-justify text-xl font-bold">1. OpenVPN:-</p><p class="text-pink-400 text-left md:text-justify">Using openvpn protocol and service of your choice (mine is Surfshark), connect to the nearest remote server, so we have added protection layer for the request to bypass.</p><p class="text-pink-400 text-left md:text-justify text-xl font-bold">2. Firewall configurations:-</p><p class="text-pink-400 text-left md:text-justify">Having strict firewall configuration, restrict all the ports on your pi, and only open the required ports as needed.</p><p class="text-pink-400 text-left md:text-justify">Ufw rules:- Only allowing incoming ports for:- ssh, internet and rdp (remote desktop) Outgoing ports for:- VPN, internet, and to router only, not other devices. You can verify up, you should be able to ping pi from any other machine on the network, but vice-versa not possible.</p><div class="flex flex-col items-center"><img src="/images/self-hosting/firewall_config.jpg" alt="Description of image" class="rounded-lg w-full max-w-[400px]"/><p class="text-pink-400 text-left md:text-justify mt-4 text-white">Firewall Configuration on Pi</p></div><p class="text-pink-400 text-left md:text-justify">Different subnet:- If your router allows, just create a different guest network so your pi and other devices are totally on different networks and cannot talk to each other.</p><p class="text-pink-400 text-left md:text-justify text-xl font-bold">3. Additional Steps:-</p><p class="text-pink-400 text-left md:text-justify">When you build your Next js app using GitHub actions it takes up a lot of time, This action, built the Next js app, created its image and pushed it to Dockerhub.</p><div class="flex flex-col items-center"><img src="/images/self-hosting/ci_cd_15.png" alt="Description of image" class="rounded-lg w-full"/><p class="text-pink-400 text-left md:text-justify mt-2 text-white">Time for Github actions to build the next js app, build and push the image on Dockerhub.</p></div><p class="text-pink-400 text-left md:text-justify">So I decided to use git pre-commit hooks, what this does is, build the Next js app locally, create a docker image, spin up the container, and if you like it and everything looks fine, you enter “Y”, then it cleans up the container, and add the build files and pushed it GitHub, and the GitHub actions builds the container, and pushes to docker hub without building next js app.</p><p class="text-pink-400 text-left md:text-justify">Reducing the build time to &lt;1min.<!-- --> </p><div class="flex flex-col items-center"><img src="/images/self-hosting/ci_cd_1.png" alt="Description of image" class="rounded-lg w-full"/><p class="text-pink-400 text-left md:text-justify mt-2 text-white">Reduced time after locally building the next js app.</p></div><p class="text-pink-400 text-left md:text-justify mt-2 text-white ">Here is the .git hooks precommit file, which runs after you enter commit<a href="https://github.com/nuttysunday/sundays-internet-home/blob/main/self-hosting-blogs-file/pre_commit_script.sh" target="_blank" rel="noopener noreferrer" class="text-blue-400 underline ml-2">View the shell script</a></p><p class="text-pink-400 text-left md:text-justify text-2xl font-bold">Method 3:-</p><p class="text-pink-400 text-left md:text-justify">1. No need to dockerize, no need to setup CI/CD pipeline to build your NextJS app or anything, directly use Vercel, which simply lets you deploy your NextJS app on it, as it handles all the configuration underhood and you need not worry about anything. Using Vercel saves you a lot of time, and you need not need to even create an account on Amazon and get your EC2 instance, or dockerize any shit in the first place. It also comes out of the box with features like caching and DDOS attacks protection.</p><p class="text-pink-400 text-left md:text-justify">2. Using Supabase for databases is like already having a MySQL server setup in the cloud for you, without you needing to do anything. Directly gives you SDK to interact with the database reducing complexity.</p></div></div></div><script src="/_next/static/chunks/webpack-2b9fb6867f1b33aa.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/e588391ba1a1e79e.css\",\"style\"]\n2:HL[\"/_next/static/css/68cef8b171ba9fef.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[95751,[],\"\"]\n5:I[17156,[\"467\",\"static/chunks/467-0209e4efb2d5d7a5.js\",\"231\",\"static/chunks/231-8b6b665dad519162.js\",\"10\",\"static/chunks/10-40d6703f678e539e.js\",\"957\",\"static/chunks/app/blogs/self-hosting/page-6ddfbf9f41080f05.js\"],\"default\"]\n6:I[231,[\"467\",\"static/chunks/467-0209e4efb2d5d7a5.js\",\"231\",\"static/chunks/231-8b6b665dad519162.js\",\"10\",\"static/chunks/10-40d6703f678e539e.js\",\"957\",\"static/chunks/app/blogs/self-hosting/page-6ddfbf9f41080f05.js\"],\"\"]\n7:I[91097,[\"467\",\"static/chunks/467-0209e4efb2d5d7a5.js\",\"231\",\"static/chunks/231-8b6b665dad519162.js\",\"10\",\"static/chunks/10-40d6703f678e539e.js\",\"957\",\"static/chunks/app/blogs/self-hosting/page-6ddfbf9f41080f05.js\"],\"default\"]\n8:I[39275,[],\"\"]\n9:I[61343,[],\"\"]\na:I[53666,[\"467\",\"static/chunks/467-0209e4efb2d5d7a5.js\",\"231\",\"static/chunks/231-8b6b665dad519162.js\",\"174\",\"static/chunks/174-3e6a25153a9a191d.js\",\"185\",\"static/chunks/app/layout-b6b862cb0fe97ac5.js\"],\"default\",1]\nb:I[39140,[\"160\",\"static/chunks/app/not-found-5210fdf515d5cae2.js\"],\"default\"]\nd:I[76130,[],\"\"]\ne:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L3\",null,{\"buildId\":\"etoqnU1_HHI7AMJdoZNUo\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"blogs\",\"self-hosting\"],\"initialTree\":[\"\",{\"children\":[\"blogs\",{\"children\":[\"self-hosting\",{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blogs\",{\"children\":[\"self-hosting\",{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"$L5\",null,{\"sx\":{\"display\":\"flex\",\"gap\":\"2rem\",\"flexDirection\":\"column\",\"overflowX\":\"hidden\"},\"children\":[[\"$\",\"$L5\",null,{\"children\":[[\"$\",\"$L6\",null,{\"href\":\"/blogs\",\"passHref\":true,\"children\":[\"$\",\"$L7\",null,{\"sx\":{\"color\":\"white\",\"cursor\":\"pointer\",\"\u0026:hover\":{\"color\":\"#fae263\"},\"position\":\"absolute\",\"left\":\"0rem\",\"marginTop\":\"1rem\",\"display\":{\"xs\":\"none\",\"sm\":\"block\"}}}]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-2xl font-bold underline decoration-4\",\"children\":\"Self-hosting\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify italic opacity-90 text-sm\",\"children\":\"18th Oct 2024, 6 min read\"}]]}]]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":[\"I am a \",[\"$\",\"em\",null,{\"children\":\"Full Stack Developer\"}],\", but still learning stuff and I consider myself naive, so please take this with a grain of salt.\"]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Developing a web app is fun, writing UI components, defining API endpoints, and designing database schemas is very interesting and can be very enjoyable and a great learning experience. But after you are done developing it locally how would you showcase this to the internet or put it into an actual production environment. I am obviously talking about very small systems here \u003c1k requests a day, where scalability is often not an issue.\"}],[\"$\",\"hr\",null,{\"style\":{\"height\":\"3px\",\"backgroundColor\":\"white\",\"border\":\"none\",\"filter\":\"blur(2px)\"}}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"className\":\"text-pink-400 text-left md:text-justify mb-2\",\"children\":[\"1. Virtual Private Server (VPS)\",[\"$\",\"br\",null,{}],[\"$\",\"em\",null,{\"style\":{\"marginLeft\":\"2rem\"},\"children\":\"DigitalOcean Droplet, AWS EC2, Google Cloud Compute Engine\"}]]}],[\"$\",\"li\",null,{\"className\":\"text-pink-400 text-left md:text-justify mb-2\",\"children\":[\"2. Self-hosting on your old computer\",[\"$\",\"br\",null,{}],[\"$\",\"em\",null,{\"style\":{\"marginLeft\":\"2rem\"},\"children\":\"Raspberry Pi\"}]]}],[\"$\",\"li\",null,{\"className\":\"text-pink-400 text-left md:text-justify mb-2\",\"children\":[\"3. Using out-of-the-box services\",[\"$\",\"br\",null,{}],[\"$\",\"em\",null,{\"style\":{\"marginLeft\":\"2rem\"},\"children\":\"Vercel, Supabase\"}]]}]]}],[\"$\",\"hr\",null,{\"style\":{\"height\":\"3px\",\"backgroundColor\":\"white\",\"border\":\"none\",\"filter\":\"blur(2px)\"}}],[\"$\",\"$L5\",null,{\"sx\":{\"maxWidth\":{\"xs\":\"90%\",\"md\":\"600px\"},\"borderRadius\":\"12px\",\"overflow\":\"hidden\",\"margin\":\"0 auto\",\"minHeight\":\"215px\"},\"children\":[\"$\",\"iframe\",null,{\"src\":\"https://www.youtube.com/embed/_IoQ6Dux8g8?si=uCX2zliGSLllFJTB\",\"allow\":\"accelerometer; clipboard-write; encrypted-media\",\"title\":\"YouTube video player\",\"style\":{\"width\":\"100%\",\"height\":\"215px\",\"border\":\"none\"}}]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-white\",\"children\":\"Youtube video showing live demo, of integrating hosting with CI/CD.\"}]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"picture\",null,{\"children\":[[\"$\",\"source\",null,{\"media\":\"(max-width: 600px)\",\"srcSet\":\"/images/self-hosting/production.png\"}],[\"$\",\"img\",null,{\"src\":\"/images/self-hosting/production.svg\",\"alt\":\"Description of image\",\"className\":\"rounded-sm w-full\"}]]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify mt-2 text-white\",\"children\":\"Understanding the pipeline\"}],[\"$\",\"a\",null,{\"href\":\"https://viewer.diagrams.net/?tags=%7B%7D\u0026lightbox=1\u0026highlight=0000ff\u0026edit=_blank\u0026layers=1\u0026nav=1\u0026title=CI%2FCD%20pipeline%20for%20portfolio%20website#Uhttps%3A%2F%2Fdrive.google.com%2Fuc%3Fid%3D1xACutzDGnT_Wto5TjsegS1OjLt--fbDw%26export%3Ddownload\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-blue-400 underline\",\"children\":\"View the HD image @draw.io\"}]]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-2xl font-bold\",\"children\":\"Common steps for method 1 and 2:-\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-xl font-bold\",\"children\":\"1. Cloudflare Tunnel\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Instead of directly exposing the IP address of your wifi or of your VPS, I recommend using a Cloudflare tunnel, as it hides your IP address, protects for DDOS and DOS attack out of the box, also gives features like Geo fencing if necessary. It is a free service, not necessary to purchase domain names from them.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-xl font-bold\",\"children\":\"2. Docker\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"In methods 1 and 2, you need to dockerize your stuff which is easy for management, and push your code. Because, there could be a simple dependency issue, for eg, you are using the MySQL-connector library for your endpoints to interact with your database. But let’s say this library is not supported for a particular Linux Distro, this could result in changing the code and could be very annoying.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Or let’s say you need to use a mysql server, if you don’t use docker you will need to download it, install it, configure it etc, but with docker just pull the mysql image, spin up the container and then you have it ready.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"So using docker, is like having a “small exact copy of a virtual machine” everywhere, and having that docker container (“Virtual machine”) run everywhere.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Another benefit is the support of docker-compose, which can easily help you manage multiple docker containers, and how they would interact with each in its docker network.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Make sure when you build the docker images, build and run them as the least privileged user, so the intruder cannot exit your docker container, or execute shell scripts inside the docker container terminal.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-xl font-bold\",\"children\":\"3. Docker watchtower\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Once you build and push the images to the docker hub, they need to be updated on the server right? So Docker Watchtower comes into play here. Docker Watchtower automatically pulls the images from the docker hub and rebuilds them automatically.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"And as we are using docker-compose, we can also smoothly integrate docker watchtower in our containers. Make sure your repository on the docker hub is public so Watchtower can pull the images.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-xl font-bold\",\"children\":\"4. Connecting Docker watchtower and Cloudflare with your Docker app in docker-compose file\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Directory Strucuture:-\"}],[\"$\",\"pre\",null,{\"className\":\"bg-blue-950/90 p-4 rounded-3xl shadow-lg\",\"children\":[\"$\",\"code\",null,{\"className\":\"text-pink-400 text-left md:text-justify \",\"children\":\"/\\n├── cloudflared/\\n│   ├── config.yml\\n│   ├── credentials.json\\n├── docker-compose.yml\\n\"}]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"credentials.json:-\"}],[\"$\",\"pre\",null,{\"className\":\"bg-blue-950/90 p-4 rounded-3xl shadow-lg overflow-x-auto\",\"children\":[\"$\",\"code\",null,{\"className\":\"text-pink-400 text-left md:text-justify whitespace-pre-wrap\",\"children\":\"{\\n tunnel: xyz\\n credentials-file: /etc/cloudflared/credentials.json\\n ingress:\\n   - hostname: commonTextStyle.foo  // domain name \\n  // service name and the port of the container which is being exposed\\n     service:  http://portfolio:8000   \\n  - hostname: books.commonTextStyle.foo  // domain name \\n     service:  http://books:8001\\n  - service: http_status:404\\n \\n}\"}]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"config.yml:-\"}],[\"$\",\"pre\",null,{\"className\":\"bg-blue-950/90 p-4 rounded-3xl shadow-lg overflow-x-auto\",\"children\":[\"$\",\"code\",null,{\"className\":\"text-pink-400 text-left md:text-justify whitespace-pre-wrap\",\"children\":\"{\\n  \\\"AccountTag\\\": \\\"abc\\\",\\n  \\\"TunnelSecret\\\": \\\"bigpass\\\",\\n  \\\"TunnelID\\\": \\\"xyz\\\"\\n}\"}]}],[\"$\",\"div\",null,{\"className\":\"bg-white/80 p-2 rounded-lg shadow-md border-l-4 border-blue-500\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-xl font-semibold text-blue-500\",\"children\":\"Important:\"}],[\"$\",\"p\",null,{\"className\":\"text-base text-gray-800\",\"children\":\"- You need to have the domain names in the DNS record on cloudflare to connect it with your tunnel.\"}],[\"$\",\"p\",null,{\"className\":\"text-base text-gray-800\",\"children\":\"- Don’t share these credentials with anyone or anyone could spoof your tunnel.\"}]]}],[\"$\",\"a\",null,{\"href\":\" https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-blue-400 underline\",\"children\":\"Traditional way of setting up cloudflare\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"I prefer to run cloudflare inside the docker container, for easier management and no need to do any external setup on the host machine.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Docker-compose file part of Cloudflare and Watchtower:-\"}],[\"$\",\"a\",null,{\"href\":\"https://github.com/nuttysunday/sundays-internet-home/blob/main/self-hosting-blogs-file/docker-compose.yml\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-blue-400 underline\",\"children\":\"Docker-compose file\"}],[\"$\",\"pre\",null,{\"className\":\"bg-blue-950/90 p-4 rounded-3xl shadow-lg overflow-x-auto\",\"children\":[\"$\",\"code\",null,{\"className\":\"text-pink-400 text-left md:text-justify whitespace-pre-wrap\",\"children\":\"\\ncloudflared:\\n  image: cloudflare/cloudflared:latest\\n  container_name: cloudflared\\n  volumes:\\n    - ./cloudflared/credentials.json:/etc/cloudflared/credentials.json:ro\\n    - ./cloudflared/config.yml:/etc/cloudflared/config.yml:ro\\n  command: tunnel --config /etc/cloudflared/config.yml run\\n  restart: always\\n  deploy:\\n    resources:\\n      limits:\\n        cpus: '0.3'\\n        memory: 256M\\n  cap_drop:\\n    - ALL\\n  read_only: true\\n  depends_on:\\n    - portfolio\\n  labels:\\n    com.centurylinklabs.watchtower.enable: \\\"true\\\"\\n  networks:\\n    - isolated_network\\n\\nwatchtower:\\n  image: containrrr/watchtower:latest\\n  container_name: watchtower\\n  volumes:\\n    - /var/run/docker.sock:/var/run/docker.sock\\n  restart: always\\n  deploy:\\n    resources:\\n      limits:\\n        cpus: '0.3'\\n        memory: 256M\\n  environment:\\n    - WATCHTOWER_LABEL_ENABLE=true\\n    - WATCHTOWER_POLL_INTERVAL=60\\n  command: --cleanup portfolio cloudflared\\n  networks:\\n    - isolated_network\\n\"}]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-xl font-bold\",\"children\":\"5. Spinning up the containers.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Step1:- Get inside the remote server\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"To transfer the files from host to server you can use scp command:-\"}],[\"$\",\"pre\",null,{\"className\":\"bg-blue-950/90 p-4 rounded-3xl shadow-lg overflow-x-auto\",\"children\":[\"$\",\"code\",null,{\"className\":\"text-pink-400 text-left md:text-justify whitespace-pre-wrap\",\"children\":\" scp -r /local/directory username@remote_host:/path/to/remote/destination/\"}]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-xl font-bold\",\"children\":\"Have your pi up and running with:-\"}],[\"$\",\"ol\",null,{\"className\":\"text-pink-400 text-left md:text-justify list-decimal list-inside\",\"children\":[[\"$\",\"li\",null,{\"children\":\"Raspberry Pi OS installed\"}],[\"$\",\"li\",null,{\"children\":\"Docker and Docker Compose installed\"}],[\"$\",\"li\",null,{\"children\":\"Remote Desktop enabled\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center mb-8 lg:mb-0\",\"children\":[[\"$\",\"img\",null,{\"src\":\"/images/self-hosting/pi.jpg\",\"alt\":\"Description of image\",\"className\":\"rounded-lg w-full max-w-[400px]\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify mt-4 text-white\",\"children\":\"PI in Action\"}]]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"After having files on the server:-\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-col lg:flex-row lg:justify-center lg:space-x-8 items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center mb-8 lg:mb-0\",\"children\":[[\"$\",\"img\",null,{\"src\":\"/images/self-hosting/ssh_pi.jpg\",\"alt\":\"Description of image\",\"className\":\"rounded-lg w-full max-w-[400px]\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify mt-4 text-white\",\"children\":\"SSH Into PI\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"img\",null,{\"src\":\"/images/self-hosting/ssh_gc.png\",\"alt\":\"Description of image\",\"className\":\"rounded-lg max-w-[400px]\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify mt-4 text-white\",\"children\":\"SSH Into Google Cloud\"}]]}]]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Spinning up the containers:-\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":[\" \",\"This will build the service and could be accessed anywhere on the internet.\"]}],[\"$\",\"pre\",null,{\"className\":\"bg-blue-950/90 p-4 rounded-2xl shadow-lg\",\"children\":[\"$\",\"code\",null,{\"className\":\"text-pink-400 text-left md:text-justify \",\"children\":\"docker-compose up –build -d\"}]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-2xl font-bold\",\"children\":\"Extra security steps for pi (method 2):-\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-xl font-bold\",\"children\":\"1. OpenVPN:-\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Using openvpn protocol and service of your choice (mine is Surfshark), connect to the nearest remote server, so we have added protection layer for the request to bypass.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-xl font-bold\",\"children\":\"2. Firewall configurations:-\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Having strict firewall configuration, restrict all the ports on your pi, and only open the required ports as needed.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Ufw rules:- Only allowing incoming ports for:- ssh, internet and rdp (remote desktop) Outgoing ports for:- VPN, internet, and to router only, not other devices. You can verify up, you should be able to ping pi from any other machine on the network, but vice-versa not possible.\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"img\",null,{\"src\":\"/images/self-hosting/firewall_config.jpg\",\"alt\":\"Description of image\",\"className\":\"rounded-lg w-full max-w-[400px]\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify mt-4 text-white\",\"children\":\"Firewall Configuration on Pi\"}]]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"Different subnet:- If your router allows, just create a different guest network so your pi and other devices are totally on different networks and cannot talk to each other.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-xl font-bold\",\"children\":\"3. Additional Steps:-\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"When you build your Next js app using GitHub actions it takes up a lot of time, This action, built the Next js app, created its image and pushed it to Dockerhub.\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"img\",null,{\"src\":\"/images/self-hosting/ci_cd_15.png\",\"alt\":\"Description of image\",\"className\":\"rounded-lg w-full\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify mt-2 text-white\",\"children\":\"Time for Github actions to build the next js app, build and push the image on Dockerhub.\"}]]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"So I decided to use git pre-commit hooks, what this does is, build the Next js app locally, create a docker image, spin up the container, and if you like it and everything looks fine, you enter “Y”, then it cleans up the container, and add the build files and pushed it GitHub, and the GitHub actions builds the container, and pushes to docker hub without building next js app.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":[\"Reducing the build time to \u003c1min.\",\" \"]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"img\",null,{\"src\":\"/images/self-hosting/ci_cd_1.png\",\"alt\":\"Description of image\",\"className\":\"rounded-lg w-full\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify mt-2 text-white\",\"children\":\"Reduced time after locally building the next js app.\"}]]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify mt-2 text-white \",\"children\":[\"Here is the .git hooks precommit file, which runs after you enter commit\",[\"$\",\"a\",null,{\"href\":\"https://github.com/nuttysunday/sundays-internet-home/blob/main/self-hosting-blogs-file/pre_commit_script.sh\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-blue-400 underline ml-2\",\"children\":\"View the shell script\"}]]}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify text-2xl font-bold\",\"children\":\"Method 3:-\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"1. No need to dockerize, no need to setup CI/CD pipeline to build your NextJS app or anything, directly use Vercel, which simply lets you deploy your NextJS app on it, as it handles all the configuration underhood and you need not worry about anything. Using Vercel saves you a lot of time, and you need not need to even create an account on Amazon and get your EC2 instance, or dockerize any shit in the first place. It also comes out of the box with features like caching and DDOS attacks protection.\"}],[\"$\",\"p\",null,{\"className\":\"text-pink-400 text-left md:text-justify\",\"children\":\"2. Using Supabase for databases is like already having a MySQL server setup in the cloud for you, without you needing to do anything. Directly gives you SDK to interact with the database reducing complexity.\"}]]}],null],null],null]},[null,[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blogs\",\"children\",\"self-hosting\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blogs\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/e588391ba1a1e79e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/68cef8b171ba9fef.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$La\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"$Lb\",null,{}],\"notFoundStyles\":[]}],\"params\":{}}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Lc\"],\"globalErrorComponent\":\"$d\",\"missingSlots\":\"$We\"}]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]]\n4:null\n"])</script></body></html>